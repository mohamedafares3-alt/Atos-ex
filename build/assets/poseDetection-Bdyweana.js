class t{constructor(){this.pose=null,this.isInitialized=!1,this.perModeState={};this.perModeState.pushups={state:"up",count:0},this.perModeState.squats={state:"up",count:0},this.perModeState.lunges={state:"up",count:0},this.perModeState.burpees={state:"up",count:0},this.perModeState.mountainclimbers={state:"neutral",count:0,_lastLeftKneeY:null,_lastRightKneeY:null,_climberState:"neutral",_lastClimberTime:0},this.perModeState.highknees={state:"down",count:0},this.perModeState.jumpingjacks={state:"down",count:0},this.perModeState.sideplank={state:"neutral",count:0},this.postureStatus="unknown",this.lastWarningTime=0,this.videoDimensionsLogged=!1,this.exerciseMode="pushups",this.accumulatedCorrectMs=0,this.timerRunning=!1,this.startCorrectTimestampMs=0,this.onPushupCount=null,this.onPostureChange=null,this.onFormFeedback=null,this.onTimeUpdate=null}setExerciseMode(t){this.perModeState[this.exerciseMode]||(this.perModeState[this.exerciseMode]={state:"up",count:0});const e=String(t||"").toLowerCase();"plank"===e?this.exerciseMode="plank":"squats"===e||"squat"===e?this.exerciseMode="squats":"lunges"===e||"lunge"===e?this.exerciseMode="lunges":"burpees"===e||"burpee"===e?this.exerciseMode="burpees":e.includes("mountain")||e.includes("climber")?this.exerciseMode="mountainclimbers":e.includes("high")&&e.includes("knees")?this.exerciseMode="highknees":e.includes("jumping")&&e.includes("jack")?this.exerciseMode="jumpingjacks":e.includes("side")&&e.includes("plank")?this.exerciseMode="sideplank":this.exerciseMode="pushups"}async initialize(){var t;try{if(!window.Pose){let t=0;for(;!window.Pose&&t<50;)await new Promise(t=>setTimeout(t,200)),t++;if(!window.Pose)return!1}this.pose=new window.Pose({locateFile:t=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${t}`});const e=(null==(t=window.MediaPipeConfig)?void 0:t.POSE_CONFIG)||{modelComplexity:0,smoothLandmarks:!0,enableSegmentation:!1,smoothSegmentation:!1,minDetectionConfidence:.5,minTrackingConfidence:.5};return this.pose.setOptions(e),this.pose.onResults(this.onResults.bind(this)),this.isInitialized=!0,!0}catch(e){return!1}}async processFrame(t){var e;if(!this.isInitialized||!this.pose)return null;try{if(Math.random(),0===t.videoWidth||0===t.videoHeight)return void Math.random();this.videoDimensionsLogged||(this.videoDimensionsLogged=!0);const e=1920,s=1080;if(t.videoWidth>e||t.videoHeight>s)return;await this.pose.send({image:t})}catch(s){if(null==(e=s.message)?void 0:e.includes("memory access out of bounds"))return}}onResults(t){var e,s,i,n,o,a,u,r,h;if(this.lastResults=t,!t.poseLandmarks)return this.postureStatus="unknown",this.onPostureChange&&this.onPostureChange("unknown",null),void(this.timerRunning&&(this.accumulatedCorrectMs+=Date.now()-this.startCorrectTimestampMs,this.timerRunning=!1,this.startCorrectTimestampMs=0,this.onTimeUpdate&&this.onTimeUpdate(Math.floor(this.accumulatedCorrectMs/1e3))));const l=t.poseLandmarks,c=this.checkBackAlignment(l);null==this._postureGoodCount&&(this._postureGoodCount=0),null==this._postureBadCount&&(this._postureBadCount=0),c?(this._postureGoodCount+=1,this._postureBadCount=0):(this._postureBadCount+=1,this._postureGoodCount=0);const d=(null==(s=null==(e=window.MediaPipeConfig)?void 0:e.SQUAT_CONFIG)?void 0:s.POSTURE_GOOD_FRAMES)??3,p="squats"===this.exerciseMode?(null==(n=null==(i=window.MediaPipeConfig)?void 0:i.SQUAT_CONFIG)?void 0:n.POSTURE_BAD_FRAMES)??6:(null==(a=null==(o=window.MediaPipeConfig)?void 0:o.SQUAT_CONFIG)?void 0:a.POSTURE_BAD_FRAMES)??4;let _=this.postureStatus;this._postureGoodCount>=d?_="correct":this._postureBadCount>=p&&(_="incorrect"),"squats"===this.exerciseMode&&(_="correct"),_!==this.postureStatus&&(this.postureStatus=_,this.onPostureChange&&this.onPostureChange(this.postureStatus,l));const S=(null==(u=window.MediaPipeConfig)?void 0:u.POSE_LANDMARKS)||{},m=l[S.LEFT_HIP||23],M=l[S.RIGHT_HIP||24],T=l[S.LEFT_KNEE||25],y=l[S.RIGHT_KNEE||26],E=m&&M?{x:(m.x+M.x)/2,y:(m.y+M.y)/2}:null,C=T&&y?{x:(T.x+y.x)/2,y:(T.y+y.y)/2}:null;if(E&&C&&(E.y,C.y),"correct"!==this.postureStatus&&!["mountainclimbers","highknees"].includes(this.exerciseMode)&&"squats"!==this.exerciseMode){const t=Date.now(),e=(null==(h=null==(r=window.MediaPipeConfig)?void 0:r.PLANK_CONFIG)?void 0:h.WARNING_COOLDOWN)||2e3;return t-this.lastWarningTime>e&&(this.playWarningSound(),this.lastWarningTime=t,this.onFormFeedback&&this.onFormFeedback({message:"Dangerous posture - straighten your back!",type:"warning",timestamp:t})),void("plank"===this.exerciseMode&&this.timerRunning&&(this.accumulatedCorrectMs+=t-this.startCorrectTimestampMs,this.timerRunning=!1,this.startCorrectTimestampMs=0,this.onTimeUpdate&&this.onTimeUpdate(Math.floor(this.accumulatedCorrectMs/1e3))))}if("plank"===this.exerciseMode){const t=Date.now();this.timerRunning||(this.startCorrectTimestampMs=t,this.timerRunning=!0);const e=this.accumulatedCorrectMs+(t-(this.startCorrectTimestampMs||t)),s=Math.floor(e/1e3);return void(this.onTimeUpdate&&this.onTimeUpdate(s))}"squats"===this.exerciseMode?this.updateSquatCounter(l):"lunges"===this.exerciseMode?this.updateLungesCounter(l):"burpees"===this.exerciseMode?this.updateBurpeesCounter(l):"mountainclimbers"===this.exerciseMode?this.updateMountainClimbersCounter(l):"highknees"===this.exerciseMode?this.updateHighKneesCounter(l):"jumpingjacks"===this.exerciseMode?this.updateJumpingJacksCounter(l):"sideplank"===this.exerciseMode?this.updateSidePlankCounter(l):this.updatePushupCounter(l)}calculateAngle(t,e,s){const i=Math.atan2(s.y-e.y,s.x-e.x)-Math.atan2(t.y-e.y,t.x-e.x);let n=Math.abs(180*i/Math.PI);return n>180&&(n=360-n),n}isPushupStartPose(t){var e,s,i;try{const n=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},o=t[n.LEFT_SHOULDER||11],a=t[n.RIGHT_SHOULDER||12],u=t[n.LEFT_HIP||23],r=t[n.RIGHT_HIP||24],h=t[n.LEFT_ANKLE||27],l=t[n.RIGHT_ANKLE||28],c=t=>t&&(null==t.visibility||t.visibility>.5);if(!(c(o)&&c(a)&&c(u)&&c(r)&&c(h)&&c(l)))return!1;const d=(o.y+a.y)/2,p=(u.y+r.y)/2,_=Math.abs(d-p);if(_>((null==(i=null==(s=window.MediaPipeConfig)?void 0:s.PUSHUP_CONFIG)?void 0:i.START_TORSO_DY)??.08))return!1;return!!((h.y+l.y)/2>p)}catch(n){return!1}}isSquatStartPose(t){var e,s,i,n,o,a,u;try{const r=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},h=t[r.LEFT_SHOULDER||11],l=t[r.RIGHT_SHOULDER||12],c=t[r.LEFT_HIP||23],d=t[r.RIGHT_HIP||24],p=t[r.LEFT_KNEE||25],_=t[r.RIGHT_KNEE||26],S=(t[r.LEFT_ANKLE||27],t[r.RIGHT_ANKLE||28],t=>t&&(null==t.visibility||t.visibility>.5));if(!(S(h)&&S(l)&&S(c)&&S(d)&&S(p)&&S(_)))return!1;const m=(c.y+d.y)/2,M=(p.y+_.y)/2;if(M-m<((null==(i=null==(s=window.MediaPipeConfig)?void 0:s.SQUAT_CONFIG)?void 0:i.START_HIP_KNEE_GAP)??.01))return!1;const T={x:(h.x+l.x)/2,y:(h.y+l.y)/2},y={x:(c.x+d.x)/2,y:(c.y+d.y)/2},E=T.x-y.x,C=T.y-y.y,g=Math.abs(180*Math.atan2(E,-C)/Math.PI),R=(null==(o=null==(n=window.MediaPipeConfig)?void 0:n.SQUAT_CONFIG)?void 0:o.STANDING_TORSO_MIN_DEG)??60,I=(null==(u=null==(a=window.MediaPipeConfig)?void 0:a.SQUAT_CONFIG)?void 0:u.STANDING_TORSO_MAX_DEG)??120;return!(g<R||g>I)}catch(r){return!1}}checkBackAlignment(t){var e,s,i,n;try{const o=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},a=t[o.LEFT_SHOULDER||11],u=t[o.RIGHT_SHOULDER||12],r=t[o.LEFT_HIP||23],h=t[o.RIGHT_HIP||24],l=t[o.LEFT_KNEE||25],c=t[o.RIGHT_KNEE||26],d=t[o.LEFT_ANKLE||27],p=t[o.RIGHT_ANKLE||28],_=t=>t&&(null==t.visibility||t.visibility>.5);if("plank"===this.exerciseMode){const t=_(a)&&_(r),e=_(u)&&_(h);if(!t&&!e)return!1}else if("pushups"===this.exerciseMode){if(!(_(a)&&_(u)&&_(r)&&_(h)))return!1}else if(!(_(a)&&_(u)&&_(r)&&_(h)&&_(l)&&_(c)))return!1;const S={x:(a.x+u.x)/2,y:(a.y+u.y)/2},m={x:(r.x+h.x)/2,y:(r.y+h.y)/2},M={x:(l.x+c.x)/2,y:(l.y+c.y)/2},T=_(d)&&_(p)?{x:(d.x+p.x)/2,y:(d.y+p.y)/2}:null,y=T||M,E={x:S.x-m.x,y:S.y-m.y},C=y?{x:y.x-m.x,y:y.y-m.y}:null;let g=!1;if("plank"===this.exerciseMode){const t=(null==(s=window.MediaPipeConfig)?void 0:s.PLANK_CONFIG)||{},e=_(a)&&_(r)&&_(d),i=_(u)&&_(h)&&_(p);if(e||i){const s=e?a:u,i=e?r:h,n=e?d:p,o=this.calculateAngle(s,i,n);if(g=o>=(t.MIN_SIDE_ANGLE??155),g&&T){const e=this.calculateAngle(r,l,d),s=this.calculateAngle(h,c,p),i=t.KNEE_MIN_DEG??150;g=g&&(e>=i&&s>=i)}}else{let e=-1;if(C){const t=Math.hypot(E.x,E.y)||1,s=Math.hypot(C.x,C.y)||1;e=(E.x*C.x+E.y*C.y)/(t*s)}const s=Math.abs(Math.max(-1,Math.min(1,e))),i=!!C&&s>=(t.STRAIGHT_ABS_COS_MIN??.9),n=S.x-m.x,o=S.y-m.y,a=Math.abs(180*Math.atan2(o,n)/Math.PI),u=t.HORIZ_MAX_DEG??35,_=a<=u||a>=180-u;let M=!0;if(T){const e=this.calculateAngle(r,l,d),s=this.calculateAngle(h,c,p),i=t.KNEE_MIN_DEG??150;M=e>=i&&s>=i}g=i&&_&&M}}else if("squats"===this.exerciseMode){const t=(null==(i=window.MediaPipeConfig)?void 0:i.SQUAT_CONFIG)||{},e=this.calculateAngle(a,r,l),s=(e+this.calculateAngle(u,h,c))/2,n=t.HIP_ANGLE_MIN??120,o=t.HIP_ANGLE_COLLAPSE??60,d=S.x-m.x,p=S.y-m.y,_=Math.abs(180*Math.atan2(d,-p)/Math.PI),T=t.TORSO_TILT_MAX??60,y=M&&m.y>M.y,E=t.COLLAPSE_TILT_MIN??70;g=!(s<o&&_>E)&&(!!y||s>=n&&_<=T)}else{const t=(null==(n=window.MediaPipeConfig)?void 0:n.PUSHUP_CONFIG)||{},e=t.SIDE_ABS_COS_MIN??.82,s=t.HORIZ_TORSO_MAX_DEG??35;if(T&&C){let t=-1;const s=Math.hypot(E.x,E.y)||1,i=Math.hypot(C.x,C.y)||1;t=(E.x*C.x+E.y*C.y)/(s*i);g=Math.abs(Math.max(-1,Math.min(1,t)))>=e}else{const t=S.x-m.x,e=S.y-m.y,i=Math.abs(180*Math.atan2(e,t)/Math.PI);g=(i<=s||i>=180-s)&&!(i>=70&&i<=110)}}return g}catch(o){return!1}}updatePushupCounter(t){var e,s,i,n,o,a;try{const u=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},r=(null==(s=window.MediaPipeConfig)?void 0:s.PUSHUP_CONFIG)||{},h=t[u.LEFT_SHOULDER||11],l=t[u.LEFT_ELBOW||13],c=t[u.LEFT_WRIST||15],d=t[u.RIGHT_SHOULDER||12],p=t[u.RIGHT_ELBOW||14],_=t[u.RIGHT_WRIST||16],S=t[u.LEFT_HIP||23],m=t[u.RIGHT_HIP||24];if(!(h&&l&&c&&d&&p&&_&&S&&m))return;const M=this.calculateAngle(h,l,c),T=(M+this.calculateAngle(d,p,_))/2,y=(h.y+d.y)/2,E=r.ELBOW_ANGLE_DOWN||95,C=r.ELBOW_ANGLE_UP||155,g=r.SHOULDER_HEIGHT_DOWN||.02,R=Math.abs((h.y+d.y)/2-(S.y+m.y)/2),I=(r.TORSO_VERTICAL_DY,!(R<(r.STANDING_DY_MIN??.05))&&(h.y+d.y)/2<(S.y+m.y)/2-(r.STANDING_DY_MIN??.02)),L=this.perModeState.pushups;L._baselineShoulderY||(L._baselineShoulderY=y),Math.abs((h.y+d.y)/2-(S.y+m.y)/2)<.12&&(L._baselineShoulderY=.95*L._baselineShoulderY+.05*y);const A=y-(L._baselineShoulderY||y),P=r.SHOULDER_DROP_THRESHOLD??.06,N=T<=E||A>=P||y>=1-g,F=T>=C&&I;L._inPositionCount||(L._inPositionCount=0);this.isPushupStartPose(t)?L._inPositionCount+=1:L._inPositionCount=0;const H=(null==(n=null==(i=window.MediaPipeConfig)?void 0:i.PUSHUP_CONFIG)?void 0:n.START_STABLE_FRAMES)??6;L._isInStartPose=L._inPositionCount>=H;const w=(null==(a=null==(o=window.MediaPipeConfig)?void 0:o.PUSHUP_CONFIG)?void 0:a.MIN_REP_MS)??400;L._lastRepAt||(L._lastRepAt=0);const O=Date.now();if("correct"!==this.postureStatus||!L._isInStartPose)return;"up"===L.state?N&&O-L._lastRepAt>w&&(L.state="down",L.count+=1,L._lastRepAt=O,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(L.count),this.onFormFeedback&&this.onFormFeedback({message:`Push-up ${L.count}`,type:"success",timestamp:O})):"down"===L.state&&(F||!N&&T>=C)&&(L.state="up")}catch(u){}}updateSquatCounter(t){var e,s,i,n;try{const o=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},a=(null==(s=window.MediaPipeConfig)||s.SQUAT_CONFIG,t[o.LEFT_HIP||23]),u=t[o.RIGHT_HIP||24],r=t[o.LEFT_KNEE||25],h=t[o.RIGHT_KNEE||26],l=t[o.LEFT_ANKLE||27],c=t[o.RIGHT_ANKLE||28],d=t[o.LEFT_SHOULDER||11],p=t[o.RIGHT_SHOULDER||12];if(!(a&&u&&r&&h&&l&&c&&d&&p))return;const _=(d.y+p.y)/2,S=(a.y+u.y)/2,m=t[o.NOSE||0],M=Math.abs(_-S),T=.08,y=Math.abs(((null==m?void 0:m.y)??0)-S);let E=!1;M<=T&&y<=.1&&(E=!0,this.onFormFeedback&&this.onFormFeedback({message:"وضع الجسم أفقي، لن يتم العد إلا في وضع الاسكوات الصحيح",type:"warning",timestamp:Date.now()}));const C=t[o.LEFT_WRIST||15],g=t[o.RIGHT_WRIST||16],R=t[o.LEFT_ANKLE||27],I=t[o.RIGHT_ANKLE||28],L=.07;let A=!1;if(C&&g&&R&&I){const t=(C.y+g.y)/2;t>=(R.y+I.y)/2-L&&(A=!0,this.onFormFeedback&&this.onFormFeedback({message:"اليدين على الأرض، لن يتم العد إلا في وضع الاسكوات الصحيح",type:"warning",timestamp:Date.now()}))}const P={x:(a.x+u.x)/2,y:(a.y+u.y)/2},N={x:(r.x+h.x)/2,y:(r.y+h.y)/2},F=(l.x,c.x,l.y,c.y,d.x,p.x,d.y,p.y,this.calculateAngle(a,r,l)),H=(this.calculateAngle(u,h,c),r.y),w=h.y,O=Math.abs(H-w),x=O<=.05,b=P.y,G=N.y,f=b>G,D=b<G,v=this.perModeState.squats,K=(null==(n=null==(i=window.MediaPipeConfig)?void 0:i.SQUAT_CONFIG)?void 0:n.MIN_REP_MS)??500;v._lastRepAt||(v._lastRepAt=0);const k=Date.now();"up"===v.state?f&&x&&!E&&!A&&k-v._lastRepAt>K?(v.state="down",v.count+=1,v._lastRepAt=k,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(v.count)):f&&x&&(E||A||v._lastRepAt):"down"===v.state&&D&&(v.state="up")}catch(o){}}updateLungesCounter(t){var e,s;try{const i=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},n=(null==(s=window.MediaPipeConfig)||s.LUNGES_CONFIG,t[i.LEFT_HIP||23]),o=t[i.RIGHT_HIP||24],a=t[i.LEFT_KNEE||25],u=t[i.RIGHT_KNEE||26],r=t[i.LEFT_ANKLE||27],h=t[i.RIGHT_ANKLE||28];if(!(n&&o&&a&&u&&r&&h))return;const l=t[i.LEFT_WRIST||15],c=t[i.RIGHT_WRIST||16],d=t[i.LEFT_ANKLE||27],p=t[i.RIGHT_ANKLE||28],_=.07;let S=!1;if(l&&c&&d&&p){const t=(l.y+c.y)/2;t>=(d.y+p.y)/2-_&&(S=!0)}const m={x:(n.x+o.x)/2,y:(n.y+o.y)/2},M=this.calculateAngle(n,a,r),T=this.calculateAngle(o,u,h),y=M<T,E=y?a:u,C=y?M:T,g=y?T:M,R=T<M,I=R?T:M,L=R?M:T,A=(m.y,E.y,.06),P=120,N=100,F=.08,H=Math.abs(a.y-u.y)>A,w=g<P,O=C<N,x=y?n:o,b=y?r:h,G=Math.abs(x.x-b.x)<F,f=H&&w&&O&&G,D=L<P,v=I<N,K=R?o:n,k=R?h:r,U=Math.abs(K.x-k.x)<F,W=f||H&&D&&v&&U,B=C>=160&&g>=150,Y=this.perModeState.lunges;"up"===Y.state?!S&&W&&(Y.state="down",Y.count+=1,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(Y.count),this.onFormFeedback&&this.onFormFeedback({message:`Lunge ${Y.count}`,type:"success",timestamp:Date.now()})):"down"===Y.state&&B&&(Y.state="up")}catch(i){}}updateMountainClimbersCounter(t){var e;try{const s=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},i=t[s.LEFT_HIP||23],n=t[s.RIGHT_HIP||24],o=t[s.LEFT_KNEE||25],a=t[s.RIGHT_KNEE||26],u=t[s.LEFT_ANKLE||27],r=t[s.RIGHT_ANKLE||28];if(!(i&&n&&o&&a&&u&&r))return;Math.abs(o.y-i.y),Math.abs(a.y-n.y);this._lastLeftKneeY||(this._lastLeftKneeY=o.y),this._lastRightKneeY||(this._lastRightKneeY=a.y),this._climberState||(this._climberState="neutral"),this._lastClimberTime||(this._lastClimberTime=Date.now());const h=.05,l=250,c=Date.now(),d=o.y-this._lastLeftKneeY,p=a.y-this._lastRightKneeY,_=d>h&&p<-h||d<-h&&p>h,S=this.perModeState.mountainclimbers;if("neutral"===S._climberState){if(_&&c-S._lastClimberTime>l&&(S._climberState="moving",S._lastClimberTime=c,S.count+=1,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(S.count),this.onFormFeedback)){const t=d>p?"Left":"Right";this.onFormFeedback({message:`${t} knee drive - Rep ${S.count}`,type:"success",timestamp:c})}}else"moving"===S._climberState&&(_||(S._climberState="neutral"));S._lastLeftKneeY=o.y,S._lastRightKneeY=a.y,Math.abs(i.y-n.y)>.1&&this.onFormFeedback&&Math.random()<.1&&this.onFormFeedback({message:"Keep hips level!",type:"warning",timestamp:c})}catch(s){}}updateBurpeesCounter(t){var e;try{const s=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},i=t[s.NOSE||0],n=t[s.LEFT_WRIST||15],o=t[s.RIGHT_WRIST||16],a=t[s.LEFT_INDEX||19],u=t[s.RIGHT_INDEX||20];if(!i||!n||!o)return;const r=i.y,h=a?a.y:n.y,l=u?u.y:o.y,c=h<r&&l<r;this._burpeeState||(this._burpeeState="ready"),this.perModeState.burpees._burpeeState||(this.perModeState.burpees._burpeeState="ready");const d=this.perModeState.burpees;"ready"===d._burpeeState?c&&(d._burpeeState="jumping",d.count+=1,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(d.count),this.onFormFeedback&&this.onFormFeedback({message:`Burpee ${d.count} - Hands above head!`,type:"success",timestamp:Date.now()})):"jumping"===d._burpeeState&&(c||(d._burpeeState="ready"))}catch(s){}}updateHighKneesCounter(t){var e;try{const s=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},i=t[s.LEFT_HIP||23],n=t[s.RIGHT_HIP||24],o=t[s.LEFT_KNEE||25],a=t[s.RIGHT_KNEE||26],u=t[s.LEFT_ANKLE||27],r=t[s.RIGHT_ANKLE||28];if(!(i&&n&&o&&a&&u&&r))return;const h=.03,l=i.y-o.y>h,c=n.y-a.y>h,d=l||c,p=this.perModeState.highknees;p._highKneesState||(p._highKneesState="stopped"),p._startTime||(p._startTime=0),p._lastUpdateTime||(p._lastUpdateTime=0);const _=Date.now();if("stopped"===p._highKneesState)d&&(p._highKneesState="active",p._startTime=_,p._lastUpdateTime=_,p.count=0);else if("active"===p._highKneesState)if(d){p._lastUpdateTime=_;const t=Math.floor((_-p._startTime)/1e3);t>p.count&&(p.count=t,this.onPushupCount&&this.onPushupCount(p.count))}else{_-p._lastUpdateTime>1500&&(p._highKneesState="stopped")}}catch(s){}}updateJumpingJacksCounter(t){var e,s;try{const i=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},n=(null==(s=window.MediaPipeConfig)?void 0:s.JUMPINGJACKS_CONFIG)||{},o=t[i.LEFT_SHOULDER||11],a=t[i.RIGHT_SHOULDER||12],u=t[i.LEFT_HIP||23],r=t[i.RIGHT_HIP||24],h=t[i.LEFT_KNEE||25],l=t[i.RIGHT_KNEE||26],c=t[i.LEFT_ELBOW||13],d=t[i.RIGHT_ELBOW||14],p=t[i.LEFT_WRIST||15],_=t[i.RIGHT_WRIST||16],S=t[i.LEFT_ANKLE||27],m=t[i.RIGHT_ANKLE||28];if(!(o&&a&&u&&r&&h&&l&&c&&d&&p&&_&&S&&m))return;const M=this.calculateAngle(c,o,p),T=this.calculateAngle(d,a,_),y=this.calculateAngle(h,u,S),E=this.calculateAngle(l,r,m),C=(this.calculateAngle(u,h,S),this.calculateAngle(r,l,m),n.SHOULDER_ABDUCTION_DOWN||60),g=n.SHOULDER_ABDUCTION_UP||120,R=n.HIP_ABDUCTION_DOWN||25,I=n.HIP_ABDUCTION_UP||30,L=(M+T)/2,A=(y+E)/2,P=(p.y+_.y)/2,N=(o.y+a.y)/2,F=(S.y,m.y,u.y,r.y,P<N),H=Math.abs(S.x-m.x)>1.2*Math.abs(u.x-r.x),w=F&&H||L>g&&A>I,O=!F&&!H||L<C&&A<R,x=this.perModeState.jumpingjacks,b=n.MIN_REP_MS||800;x._lastRepAt||(x._lastRepAt=0);const G=Date.now();"down"===x.state?w&&G-(x._lastStateChange||0)>300&&(x.state="up",x._lastStateChange=G):"up"===x.state&&O&&G-x._lastRepAt>b&&G-(x._lastStateChange||0)>300&&(x.state="down",x.count+=1,x._lastRepAt=G,x._lastStateChange=G,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(x.count),this.onFormFeedback&&this.onFormFeedback({message:`Jumping Jack ${x.count}`,type:"success",timestamp:G}))}catch(i){}}updateSidePlankCounter(t){var e,s;try{const i=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},n=(null==(s=window.MediaPipeConfig)?void 0:s.SIDEPLANK_CONFIG)||{},o=t[i.LEFT_SHOULDER||11],a=t[i.RIGHT_SHOULDER||12],u=t[i.LEFT_ELBOW||13],r=t[i.RIGHT_ELBOW||14],h=t[i.LEFT_WRIST||15],l=t[i.RIGHT_WRIST||16],c=t[i.LEFT_HIP||23],d=t[i.RIGHT_HIP||24],p=t[i.LEFT_KNEE||25],_=t[i.RIGHT_KNEE||26],S=t[i.LEFT_ANKLE||27],m=t[i.RIGHT_ANKLE||28],M=(t[i.NOSE||0],t[i.LEFT_EAR||7]),T=t[i.RIGHT_EAR||8],y=t=>t&&(null==t.visibility||t.visibility>.5),E=y(o)&&y(u)&&y(c)&&y(p)&&y(S),C=y(a)&&y(r)&&y(d)&&y(_)&&y(m);if(!E&&!C)return;const g=E&&(!C||E),R=g?o:a,I=g?u:r,L=g?h:l,A=g?c:d,P=g?S:m,N=g?M:T,F=this.calculateAngle(R,I,L),H=n.SHOULDER_ANGLE_MIN||80,w=n.SHOULDER_ANGLE_MAX||100,O=F>=H&&F<=w,x=this.calculateAngle(R,A,P),b=n.TORSO_ANGLE_MIN||160,G=n.TORSO_ANGLE_MAX||200,f=x>=b&&x<=G,D=(R.y+P.y)/2,v=n.HIP_SAG_THRESHOLD||.05,K=A.y>D+v,k=n.HIP_HIKE_THRESHOLD||.05,U=A.y<D-k,W=n.ELBOW_ALIGNMENT_THRESHOLD||.08,B=Math.abs(I.x-R.x)<W,Y=n.FEET_STACKING_THRESHOLD||.1,j=Math.abs(S.x-m.x)<Y;let q=!0;if(N&&y(N)){const t=this.calculateAngle(N,R,A),e=n.HEAD_NECK_ANGLE_MIN||160,s=n.HEAD_NECK_ANGLE_MAX||200;q=t>=e&&t<=s}const Q=O&&f&&!K&&!U&&B&&j&&q;Q?(this._postureGoodCount=(this._postureGoodCount||0)+1,this._postureBadCount=0):(this._postureBadCount=(this._postureBadCount||0)+1,this._postureGoodCount=0);const X=n.POSTURE_GOOD_FRAMES||3,J=n.POSTURE_BAD_FRAMES||4;let $=this.postureStatus;if(this._postureGoodCount>=X?$="correct":this._postureBadCount>=J&&($="incorrect"),$!==this.postureStatus&&(this.postureStatus=$,this.onPostureChange&&this.onPostureChange(this.postureStatus,t)),"correct"===this.postureStatus){const t=Date.now();this.timerRunning||(this.startCorrectTimestampMs=t,this.timerRunning=!0);const e=this.accumulatedCorrectMs+(t-(this.startCorrectTimestampMs||t)),s=Math.floor(e/1e3);this.onTimeUpdate&&this.onTimeUpdate(s)}else this.timerRunning&&(this.accumulatedCorrectMs+=Date.now()-this.startCorrectTimestampMs,this.timerRunning=!1,this.startCorrectTimestampMs=0,this.onTimeUpdate&&this.onTimeUpdate(Math.floor(this.accumulatedCorrectMs/1e3)));if(!Q&&this.onFormFeedback){const t=Date.now(),e=n.WARNING_COOLDOWN||2e3;if(t-this.lastWarningTime>e){let e="";K?e="Hip sagging - lift your hips up!":U?e="Hip too high - lower your hips!":B?j?O?f||(e="Keep your body straight!"):e="Adjust your arm position!":e="Stack your feet together!":e="Keep elbow under shoulder!",e&&(this.onFormFeedback({message:e,type:"warning",timestamp:t}),this.lastWarningTime=t)}}}catch(i){}}playWarningSound(){try{const t=new(window.AudioContext||window.webkitAudioContext),e=t.createOscillator(),s=t.createGain();e.connect(s),s.connect(t.destination),e.frequency.setValueAtTime(800,t.currentTime),e.type="sine",s.gain.setValueAtTime(0,t.currentTime),s.gain.linearRampToValueAtTime(.3,t.currentTime+.1),s.gain.exponentialRampToValueAtTime(.01,t.currentTime+.5),e.start(t.currentTime),e.stop(t.currentTime+.5)}catch(t){}}playSuccessSound(){try{const t=new Audio("/assets/sounds/pop.wav");t.volume=.5,t.play().catch(t=>{})}catch(t){}}drawPoseOverlay(t,e,s,i){if(Math.random(),!e.poseLandmarks||!t)return;t.save(),t.clearRect(0,0,s,i);const n=e.poseLandmarks;n.forEach((e,n)=>{if(e.visibility&&e.visibility>.5){const n=e.x*s,o=e.y*i;t.beginPath(),t.arc(n,o,6,0,2*Math.PI),t.fillStyle=e.visibility>.7?"#10B981":"#F59E0B",t.fill(),t.strokeStyle="#FFFFFF",t.lineWidth=2,t.stroke()}}),Math.random(),this.drawBasicConnections(t,n,s,i),t.restore()}drawBasicConnections(t,e,s,i){[[11,12],[11,13],[13,15],[12,14],[14,16],[11,23],[12,24],[23,24],[23,25],[25,27],[24,26],[26,28]].forEach(([n,o])=>{const a=e[n],u=e[o];a&&u&&a.visibility>.5&&u.visibility>.5&&(t.beginPath(),t.moveTo(a.x*s,a.y*i),t.lineTo(u.x*s,u.y*i),t.strokeStyle="#3B82F6",t.lineWidth=3,t.stroke())}),Math.random()}resetCounter(){const t=this.exerciseMode;this.perModeState&&this.perModeState[t]&&(this.perModeState[t].count=0,this.perModeState[t].state="up","mountainclimbers"===t&&(this.perModeState[t]._lastLeftKneeY=null,this.perModeState[t]._lastRightKneeY=null,this.perModeState[t]._climberState="neutral",this.perModeState[t]._lastClimberTime=0),"burpees"===t&&(this.perModeState[t]._burpeeState="ready"),"jumpingjacks"===t&&(this.perModeState[t]._lastRepAt=0),"sideplank"===t&&(this.perModeState[t].state="neutral",this.perModeState[t].count=0)),this.postureStatus="unknown",this.accumulatedCorrectMs=0,this.timerRunning=!1,this.startCorrectTimestampMs=0}getStats(){const t=this.exerciseMode,e=this.perModeState&&this.perModeState[t]?this.perModeState[t]:{count:0,state:"up"};return{count:e.count||0,state:e.state||"up",posture:this.postureStatus,timeSec:Math.floor((this.accumulatedCorrectMs+(this.timerRunning?Date.now()-this.startCorrectTimestampMs:0))/1e3)}}getLastResults(){return this.lastResults}setCallbacks({onPushupCount:t,onPostureChange:e,onFormFeedback:s,onTimeUpdate:i}){this.onPushupCount=t,this.onPostureChange=e,this.onFormFeedback=s,this.onTimeUpdate=i}cleanup(){this.pose&&(this.pose.close(),this.pose=null),this.isInitialized=!1}}export{t as default};
//# sourceMappingURL=poseDetection-Bdyweana.js.map
