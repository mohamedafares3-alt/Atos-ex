class t{constructor(){this.pose=null,this.isInitialized=!1,this.perModeState={};this.perModeState.pushups={state:"up",count:0},this.perModeState.squats={state:"up",count:0},this.perModeState.lunges={state:"up",count:0},this.perModeState.burpees={state:"up",count:0},this.perModeState.mountainclimbers={state:"neutral",count:0,_lastLeftKneeY:null,_lastRightKneeY:null,_climberState:"neutral",_lastClimberTime:0},this.perModeState.highknees={state:"down",count:0},this.postureStatus="unknown",this.lastWarningTime=0,this.videoDimensionsLogged=!1,this.exerciseMode="pushups",this.accumulatedCorrectMs=0,this.timerRunning=!1,this.startCorrectTimestampMs=0,this.onPushupCount=null,this.onPostureChange=null,this.onFormFeedback=null,this.onTimeUpdate=null}setExerciseMode(t){this.perModeState[this.exerciseMode]||(this.perModeState[this.exerciseMode]={state:"up",count:0});const e=String(t||"").toLowerCase();"plank"===e?this.exerciseMode="plank":"squats"===e||"squat"===e?this.exerciseMode="squats":"lunges"===e||"lunge"===e?this.exerciseMode="lunges":"burpees"===e||"burpee"===e?this.exerciseMode="burpees":e.includes("mountain")||e.includes("climber")?this.exerciseMode="mountainclimbers":e.includes("high")&&e.includes("knees")?this.exerciseMode="highknees":this.exerciseMode="pushups"}async initialize(){var t;try{if(!window.Pose){let t=0;for(;!window.Pose&&t<50;)await new Promise(t=>setTimeout(t,200)),t++;if(!window.Pose)return!1}this.pose=new window.Pose({locateFile:t=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${t}`});const e=(null==(t=window.MediaPipeConfig)?void 0:t.POSE_CONFIG)||{modelComplexity:0,smoothLandmarks:!0,enableSegmentation:!1,smoothSegmentation:!1,minDetectionConfidence:.5,minTrackingConfidence:.5};return this.pose.setOptions(e),this.pose.onResults(this.onResults.bind(this)),this.isInitialized=!0,!0}catch(e){return!1}}async processFrame(t){var e;if(!this.isInitialized||!this.pose)return null;try{if(Math.random(),0===t.videoWidth||0===t.videoHeight)return void Math.random();this.videoDimensionsLogged||(this.videoDimensionsLogged=!0);const e=1920,i=1080;if(t.videoWidth>e||t.videoHeight>i)return;await this.pose.send({image:t})}catch(i){if(null==(e=i.message)?void 0:e.includes("memory access out of bounds"))return}}onResults(t){var e,i,s,n,o,a,u,r,h;if(this.lastResults=t,!t.poseLandmarks)return this.postureStatus="unknown",this.onPostureChange&&this.onPostureChange("unknown",null),void(this.timerRunning&&(this.accumulatedCorrectMs+=Date.now()-this.startCorrectTimestampMs,this.timerRunning=!1,this.startCorrectTimestampMs=0,this.onTimeUpdate&&this.onTimeUpdate(Math.floor(this.accumulatedCorrectMs/1e3))));const l=t.poseLandmarks,c=this.checkBackAlignment(l);null==this._postureGoodCount&&(this._postureGoodCount=0),null==this._postureBadCount&&(this._postureBadCount=0),c?(this._postureGoodCount+=1,this._postureBadCount=0):(this._postureBadCount+=1,this._postureGoodCount=0);const d=(null==(i=null==(e=window.MediaPipeConfig)?void 0:e.SQUAT_CONFIG)?void 0:i.POSTURE_GOOD_FRAMES)??3,p="squats"===this.exerciseMode?(null==(n=null==(s=window.MediaPipeConfig)?void 0:s.SQUAT_CONFIG)?void 0:n.POSTURE_BAD_FRAMES)??6:(null==(a=null==(o=window.MediaPipeConfig)?void 0:o.SQUAT_CONFIG)?void 0:a.POSTURE_BAD_FRAMES)??4;let _=this.postureStatus;this._postureGoodCount>=d?_="correct":this._postureBadCount>=p&&(_="incorrect"),"squats"===this.exerciseMode&&(_="correct"),_!==this.postureStatus&&(this.postureStatus=_,this.onPostureChange&&this.onPostureChange(this.postureStatus,l));const y=(null==(u=window.MediaPipeConfig)?void 0:u.POSE_LANDMARKS)||{},m=l[y.LEFT_HIP||23],S=l[y.RIGHT_HIP||24],M=l[y.LEFT_KNEE||25],T=l[y.RIGHT_KNEE||26],E=m&&S?{x:(m.x+S.x)/2,y:(m.y+S.y)/2}:null,C=M&&T?{x:(M.x+T.x)/2,y:(M.y+T.y)/2}:null;if(E&&C&&(E.y,C.y),"correct"!==this.postureStatus&&!["mountainclimbers","highknees"].includes(this.exerciseMode)&&"squats"!==this.exerciseMode){const t=Date.now(),e=(null==(h=null==(r=window.MediaPipeConfig)?void 0:r.PLANK_CONFIG)?void 0:h.WARNING_COOLDOWN)||2e3;return t-this.lastWarningTime>e&&(this.playWarningSound(),this.lastWarningTime=t,this.onFormFeedback&&this.onFormFeedback({message:"Dangerous posture - straighten your back!",type:"warning",timestamp:t})),void("plank"===this.exerciseMode&&this.timerRunning&&(this.accumulatedCorrectMs+=t-this.startCorrectTimestampMs,this.timerRunning=!1,this.startCorrectTimestampMs=0,this.onTimeUpdate&&this.onTimeUpdate(Math.floor(this.accumulatedCorrectMs/1e3))))}if("plank"===this.exerciseMode){const t=Date.now();this.timerRunning||(this.startCorrectTimestampMs=t,this.timerRunning=!0);const e=this.accumulatedCorrectMs+(t-(this.startCorrectTimestampMs||t)),i=Math.floor(e/1e3);return void(this.onTimeUpdate&&this.onTimeUpdate(i))}"squats"===this.exerciseMode?this.updateSquatCounter(l):"lunges"===this.exerciseMode?this.updateLungesCounter(l):"burpees"===this.exerciseMode?this.updateBurpeesCounter(l):"mountainclimbers"===this.exerciseMode?this.updateMountainClimbersCounter(l):"highknees"===this.exerciseMode?this.updateHighKneesCounter(l):this.updatePushupCounter(l)}calculateAngle(t,e,i){const s=Math.atan2(i.y-e.y,i.x-e.x)-Math.atan2(t.y-e.y,t.x-e.x);let n=Math.abs(180*s/Math.PI);return n>180&&(n=360-n),n}isPushupStartPose(t){var e,i,s;try{const n=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},o=t[n.LEFT_SHOULDER||11],a=t[n.RIGHT_SHOULDER||12],u=t[n.LEFT_HIP||23],r=t[n.RIGHT_HIP||24],h=t[n.LEFT_ANKLE||27],l=t[n.RIGHT_ANKLE||28],c=t=>t&&(null==t.visibility||t.visibility>.5);if(!(c(o)&&c(a)&&c(u)&&c(r)&&c(h)&&c(l)))return!1;const d=(o.y+a.y)/2,p=(u.y+r.y)/2,_=Math.abs(d-p);if(_>((null==(s=null==(i=window.MediaPipeConfig)?void 0:i.PUSHUP_CONFIG)?void 0:s.START_TORSO_DY)??.08))return!1;return!!((h.y+l.y)/2>p)}catch(n){return!1}}isSquatStartPose(t){var e,i,s,n,o,a,u;try{const r=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},h=t[r.LEFT_SHOULDER||11],l=t[r.RIGHT_SHOULDER||12],c=t[r.LEFT_HIP||23],d=t[r.RIGHT_HIP||24],p=t[r.LEFT_KNEE||25],_=t[r.RIGHT_KNEE||26],y=(t[r.LEFT_ANKLE||27],t[r.RIGHT_ANKLE||28],t=>t&&(null==t.visibility||t.visibility>.5));if(!(y(h)&&y(l)&&y(c)&&y(d)&&y(p)&&y(_)))return!1;const m=(c.y+d.y)/2,S=(p.y+_.y)/2;if(S-m<((null==(s=null==(i=window.MediaPipeConfig)?void 0:i.SQUAT_CONFIG)?void 0:s.START_HIP_KNEE_GAP)??.01))return!1;const M={x:(h.x+l.x)/2,y:(h.y+l.y)/2},T={x:(c.x+d.x)/2,y:(c.y+d.y)/2},E=M.x-T.x,C=M.y-T.y,g=Math.abs(180*Math.atan2(E,-C)/Math.PI),P=(null==(o=null==(n=window.MediaPipeConfig)?void 0:n.SQUAT_CONFIG)?void 0:o.STANDING_TORSO_MIN_DEG)??60,R=(null==(u=null==(a=window.MediaPipeConfig)?void 0:a.SQUAT_CONFIG)?void 0:u.STANDING_TORSO_MAX_DEG)??120;return!(g<P||g>R)}catch(r){return!1}}checkBackAlignment(t){var e,i,s,n;try{const o=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},a=t[o.LEFT_SHOULDER||11],u=t[o.RIGHT_SHOULDER||12],r=t[o.LEFT_HIP||23],h=t[o.RIGHT_HIP||24],l=t[o.LEFT_KNEE||25],c=t[o.RIGHT_KNEE||26],d=t[o.LEFT_ANKLE||27],p=t[o.RIGHT_ANKLE||28],_=t=>t&&(null==t.visibility||t.visibility>.5);if("plank"===this.exerciseMode){const t=_(a)&&_(r),e=_(u)&&_(h);if(!t&&!e)return!1}else if("pushups"===this.exerciseMode){if(!(_(a)&&_(u)&&_(r)&&_(h)))return!1}else if(!(_(a)&&_(u)&&_(r)&&_(h)&&_(l)&&_(c)))return!1;const y={x:(a.x+u.x)/2,y:(a.y+u.y)/2},m={x:(r.x+h.x)/2,y:(r.y+h.y)/2},S={x:(l.x+c.x)/2,y:(l.y+c.y)/2},M=_(d)&&_(p)?{x:(d.x+p.x)/2,y:(d.y+p.y)/2}:null,T=M||S,E={x:y.x-m.x,y:y.y-m.y},C=T?{x:T.x-m.x,y:T.y-m.y}:null;let g=!1;if("plank"===this.exerciseMode){const t=(null==(i=window.MediaPipeConfig)?void 0:i.PLANK_CONFIG)||{},e=_(a)&&_(r)&&_(d),s=_(u)&&_(h)&&_(p);if(e||s){const i=e?a:u,s=e?r:h,n=e?d:p,o=this.calculateAngle(i,s,n);if(g=o>=(t.MIN_SIDE_ANGLE??155),g&&M){const e=this.calculateAngle(r,l,d),i=this.calculateAngle(h,c,p),s=t.KNEE_MIN_DEG??150;g=g&&(e>=s&&i>=s)}}else{let e=-1;if(C){const t=Math.hypot(E.x,E.y)||1,i=Math.hypot(C.x,C.y)||1;e=(E.x*C.x+E.y*C.y)/(t*i)}const i=Math.abs(Math.max(-1,Math.min(1,e))),s=!!C&&i>=(t.STRAIGHT_ABS_COS_MIN??.9),n=y.x-m.x,o=y.y-m.y,a=Math.abs(180*Math.atan2(o,n)/Math.PI),u=t.HORIZ_MAX_DEG??35,_=a<=u||a>=180-u;let S=!0;if(M){const e=this.calculateAngle(r,l,d),i=this.calculateAngle(h,c,p),s=t.KNEE_MIN_DEG??150;S=e>=s&&i>=s}g=s&&_&&S}}else if("squats"===this.exerciseMode){const t=(null==(s=window.MediaPipeConfig)?void 0:s.SQUAT_CONFIG)||{},e=this.calculateAngle(a,r,l),i=(e+this.calculateAngle(u,h,c))/2,n=t.HIP_ANGLE_MIN??120,o=t.HIP_ANGLE_COLLAPSE??60,d=y.x-m.x,p=y.y-m.y,_=Math.abs(180*Math.atan2(d,-p)/Math.PI),M=t.TORSO_TILT_MAX??60,T=S&&m.y>S.y,E=t.COLLAPSE_TILT_MIN??70;g=!(i<o&&_>E)&&(!!T||i>=n&&_<=M)}else{const t=(null==(n=window.MediaPipeConfig)?void 0:n.PUSHUP_CONFIG)||{},e=t.SIDE_ABS_COS_MIN??.82,i=t.HORIZ_TORSO_MAX_DEG??35;if(M&&C){let t=-1;const i=Math.hypot(E.x,E.y)||1,s=Math.hypot(C.x,C.y)||1;t=(E.x*C.x+E.y*C.y)/(i*s);g=Math.abs(Math.max(-1,Math.min(1,t)))>=e}else{const t=y.x-m.x,e=y.y-m.y,s=Math.abs(180*Math.atan2(e,t)/Math.PI);g=(s<=i||s>=180-i)&&!(s>=70&&s<=110)}}return g}catch(o){return!1}}updatePushupCounter(t){var e,i,s,n,o,a;try{const u=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},r=(null==(i=window.MediaPipeConfig)?void 0:i.PUSHUP_CONFIG)||{},h=t[u.LEFT_SHOULDER||11],l=t[u.LEFT_ELBOW||13],c=t[u.LEFT_WRIST||15],d=t[u.RIGHT_SHOULDER||12],p=t[u.RIGHT_ELBOW||14],_=t[u.RIGHT_WRIST||16],y=t[u.LEFT_HIP||23],m=t[u.RIGHT_HIP||24];if(!(h&&l&&c&&d&&p&&_&&y&&m))return;const S=this.calculateAngle(h,l,c),M=(S+this.calculateAngle(d,p,_))/2,T=(h.y+d.y)/2,E=r.ELBOW_ANGLE_DOWN||95,C=r.ELBOW_ANGLE_UP||155,g=r.SHOULDER_HEIGHT_DOWN||.02,P=Math.abs((h.y+d.y)/2-(y.y+m.y)/2),R=(r.TORSO_VERTICAL_DY,!(P<(r.STANDING_DY_MIN??.05))&&(h.y+d.y)/2<(y.y+m.y)/2-(r.STANDING_DY_MIN??.02)),I=this.perModeState.pushups;I._baselineShoulderY||(I._baselineShoulderY=T),Math.abs((h.y+d.y)/2-(y.y+m.y)/2)<.12&&(I._baselineShoulderY=.95*I._baselineShoulderY+.05*T);const L=T-(I._baselineShoulderY||T),A=r.SHOULDER_DROP_THRESHOLD??.06,w=M<=E||L>=A||T>=1-g,F=M>=C&&R;I._inPositionCount||(I._inPositionCount=0);this.isPushupStartPose(t)?I._inPositionCount+=1:I._inPositionCount=0;const x=(null==(n=null==(s=window.MediaPipeConfig)?void 0:s.PUSHUP_CONFIG)?void 0:n.START_STABLE_FRAMES)??6;I._isInStartPose=I._inPositionCount>=x;const b=(null==(a=null==(o=window.MediaPipeConfig)?void 0:o.PUSHUP_CONFIG)?void 0:a.MIN_REP_MS)??400;I._lastRepAt||(I._lastRepAt=0);const N=Date.now();if("correct"!==this.postureStatus||!I._isInStartPose)return;"up"===I.state?w&&N-I._lastRepAt>b&&(I.state="down",I.count+=1,I._lastRepAt=N,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(I.count),this.onFormFeedback&&this.onFormFeedback({message:`Push-up ${I.count}`,type:"success",timestamp:N})):"down"===I.state&&(F||!w&&M>=C)&&(I.state="up")}catch(u){}}updateSquatCounter(t){var e,i,s,n;try{const o=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},a=(null==(i=window.MediaPipeConfig)||i.SQUAT_CONFIG,t[o.LEFT_HIP||23]),u=t[o.RIGHT_HIP||24],r=t[o.LEFT_KNEE||25],h=t[o.RIGHT_KNEE||26],l=t[o.LEFT_ANKLE||27],c=t[o.RIGHT_ANKLE||28],d=t[o.LEFT_SHOULDER||11],p=t[o.RIGHT_SHOULDER||12];if(!(a&&u&&r&&h&&l&&c&&d&&p))return;const _=(d.y+p.y)/2,y=(a.y+u.y)/2,m=t[o.NOSE||0],S=Math.abs(_-y),M=.08,T=Math.abs(((null==m?void 0:m.y)??0)-y);let E=!1;S<=M&&T<=.1&&(E=!0,this.onFormFeedback&&this.onFormFeedback({message:"وضع الجسم أفقي، لن يتم العد إلا في وضع الاسكوات الصحيح",type:"warning",timestamp:Date.now()}));const C=t[o.LEFT_WRIST||15],g=t[o.RIGHT_WRIST||16],P=t[o.LEFT_ANKLE||27],R=t[o.RIGHT_ANKLE||28],I=.07;let L=!1;if(C&&g&&P&&R){const t=(C.y+g.y)/2;t>=(P.y+R.y)/2-I&&(L=!0,this.onFormFeedback&&this.onFormFeedback({message:"اليدين على الأرض، لن يتم العد إلا في وضع الاسكوات الصحيح",type:"warning",timestamp:Date.now()}))}const A={x:(a.x+u.x)/2,y:(a.y+u.y)/2},w={x:(r.x+h.x)/2,y:(r.y+h.y)/2},F=(l.x,c.x,l.y,c.y,d.x,p.x,d.y,p.y,this.calculateAngle(a,r,l)),x=(this.calculateAngle(u,h,c),r.y),b=h.y,N=Math.abs(x-b),f=N<=.05,v=A.y,H=w.y,G=v>H,O=v<H,K=this.perModeState.squats,D=(null==(n=null==(s=window.MediaPipeConfig)?void 0:s.SQUAT_CONFIG)?void 0:n.MIN_REP_MS)??500;K._lastRepAt||(K._lastRepAt=0);const k=Date.now();"up"===K.state?G&&f&&!E&&!L&&k-K._lastRepAt>D?(K.state="down",K.count+=1,K._lastRepAt=k,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(K.count)):G&&f&&(E||L||K._lastRepAt):"down"===K.state&&O&&(K.state="up")}catch(o){}}updateLungesCounter(t){var e,i;try{const s=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},n=(null==(i=window.MediaPipeConfig)||i.LUNGES_CONFIG,t[s.LEFT_HIP||23]),o=t[s.RIGHT_HIP||24],a=t[s.LEFT_KNEE||25],u=t[s.RIGHT_KNEE||26],r=t[s.LEFT_ANKLE||27],h=t[s.RIGHT_ANKLE||28];if(!(n&&o&&a&&u&&r&&h))return;const l=t[s.LEFT_WRIST||15],c=t[s.RIGHT_WRIST||16],d=t[s.LEFT_ANKLE||27],p=t[s.RIGHT_ANKLE||28],_=.07;let y=!1;if(l&&c&&d&&p){const t=(l.y+c.y)/2;t>=(d.y+p.y)/2-_&&(y=!0)}const m={x:(n.x+o.x)/2,y:(n.y+o.y)/2},S=this.calculateAngle(n,a,r),M=this.calculateAngle(o,u,h),T=S<M,E=T?a:u,C=T?S:M,g=T?M:S,P=M<S,R=P?M:S,I=P?S:M,L=(m.y,E.y,.06),A=120,w=100,F=.08,x=Math.abs(a.y-u.y)>L,b=g<A,N=C<w,f=T?n:o,v=T?r:h,H=Math.abs(f.x-v.x)<F,G=x&&b&&N&&H,O=I<A,K=R<w,D=P?o:n,k=P?h:r,U=Math.abs(D.x-k.x)<F,W=G||x&&O&&K&&U,B=C>=160&&g>=150,Y=this.perModeState.lunges;"up"===Y.state?!y&&W&&(Y.state="down",Y.count+=1,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(Y.count),this.onFormFeedback&&this.onFormFeedback({message:`Lunge ${Y.count}`,type:"success",timestamp:Date.now()})):"down"===Y.state&&B&&(Y.state="up")}catch(s){}}updateMountainClimbersCounter(t){var e;try{const i=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},s=t[i.LEFT_HIP||23],n=t[i.RIGHT_HIP||24],o=t[i.LEFT_KNEE||25],a=t[i.RIGHT_KNEE||26],u=t[i.LEFT_ANKLE||27],r=t[i.RIGHT_ANKLE||28];if(!(s&&n&&o&&a&&u&&r))return;Math.abs(o.y-s.y),Math.abs(a.y-n.y);this._lastLeftKneeY||(this._lastLeftKneeY=o.y),this._lastRightKneeY||(this._lastRightKneeY=a.y),this._climberState||(this._climberState="neutral"),this._lastClimberTime||(this._lastClimberTime=Date.now());const h=.05,l=250,c=Date.now(),d=o.y-this._lastLeftKneeY,p=a.y-this._lastRightKneeY,_=d>h&&p<-h||d<-h&&p>h,y=this.perModeState.mountainclimbers;if("neutral"===y._climberState){if(_&&c-y._lastClimberTime>l&&(y._climberState="moving",y._lastClimberTime=c,y.count+=1,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(y.count),this.onFormFeedback)){const t=d>p?"Left":"Right";this.onFormFeedback({message:`${t} knee drive - Rep ${y.count}`,type:"success",timestamp:c})}}else"moving"===y._climberState&&(_||(y._climberState="neutral"));y._lastLeftKneeY=o.y,y._lastRightKneeY=a.y,Math.abs(s.y-n.y)>.1&&this.onFormFeedback&&Math.random()<.1&&this.onFormFeedback({message:"Keep hips level!",type:"warning",timestamp:c})}catch(i){}}updateBurpeesCounter(t){var e;try{const i=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},s=t[i.NOSE||0],n=t[i.LEFT_WRIST||15],o=t[i.RIGHT_WRIST||16],a=t[i.LEFT_INDEX||19],u=t[i.RIGHT_INDEX||20];if(!s||!n||!o)return;const r=s.y,h=a?a.y:n.y,l=u?u.y:o.y,c=h<r&&l<r;this._burpeeState||(this._burpeeState="ready"),this.perModeState.burpees._burpeeState||(this.perModeState.burpees._burpeeState="ready");const d=this.perModeState.burpees;"ready"===d._burpeeState?c&&(d._burpeeState="jumping",d.count+=1,this.playSuccessSound(),this.onPushupCount&&this.onPushupCount(d.count),this.onFormFeedback&&this.onFormFeedback({message:`Burpee ${d.count} - Hands above head!`,type:"success",timestamp:Date.now()})):"jumping"===d._burpeeState&&(c||(d._burpeeState="ready"))}catch(i){}}updateHighKneesCounter(t){var e;try{const i=(null==(e=window.MediaPipeConfig)?void 0:e.POSE_LANDMARKS)||{},s=t[i.LEFT_HIP||23],n=t[i.RIGHT_HIP||24],o=t[i.LEFT_KNEE||25],a=t[i.RIGHT_KNEE||26],u=t[i.LEFT_ANKLE||27],r=t[i.RIGHT_ANKLE||28];if(!(s&&n&&o&&a&&u&&r))return;const h=.03,l=s.y-o.y>h,c=n.y-a.y>h,d=l||c,p=this.perModeState.highknees;p._highKneesState||(p._highKneesState="stopped"),p._startTime||(p._startTime=0),p._lastUpdateTime||(p._lastUpdateTime=0);const _=Date.now();if("stopped"===p._highKneesState)d&&(p._highKneesState="active",p._startTime=_,p._lastUpdateTime=_,p.count=0);else if("active"===p._highKneesState)if(d){p._lastUpdateTime=_;const t=Math.floor((_-p._startTime)/1e3);t>p.count&&(p.count=t,this.onPushupCount&&this.onPushupCount(p.count))}else{_-p._lastUpdateTime>1500&&(p._highKneesState="stopped")}}catch(i){}}playWarningSound(){try{const t=new(window.AudioContext||window.webkitAudioContext),e=t.createOscillator(),i=t.createGain();e.connect(i),i.connect(t.destination),e.frequency.setValueAtTime(800,t.currentTime),e.type="sine",i.gain.setValueAtTime(0,t.currentTime),i.gain.linearRampToValueAtTime(.3,t.currentTime+.1),i.gain.exponentialRampToValueAtTime(.01,t.currentTime+.5),e.start(t.currentTime),e.stop(t.currentTime+.5)}catch(t){}}playSuccessSound(){try{const t=new Audio("/assets/sounds/pop.wav");t.volume=.5,t.play().catch(t=>{})}catch(t){}}drawPoseOverlay(t,e,i,s){if(Math.random(),!e.poseLandmarks||!t)return;t.save(),t.clearRect(0,0,i,s);const n=e.poseLandmarks;n.forEach((e,n)=>{if(e.visibility&&e.visibility>.5){const n=e.x*i,o=e.y*s;t.beginPath(),t.arc(n,o,6,0,2*Math.PI),t.fillStyle=e.visibility>.7?"#10B981":"#F59E0B",t.fill(),t.strokeStyle="#FFFFFF",t.lineWidth=2,t.stroke()}}),Math.random(),this.drawBasicConnections(t,n,i,s),t.restore()}drawBasicConnections(t,e,i,s){[[11,12],[11,13],[13,15],[12,14],[14,16],[11,23],[12,24],[23,24],[23,25],[25,27],[24,26],[26,28]].forEach(([n,o])=>{const a=e[n],u=e[o];a&&u&&a.visibility>.5&&u.visibility>.5&&(t.beginPath(),t.moveTo(a.x*i,a.y*s),t.lineTo(u.x*i,u.y*s),t.strokeStyle="#3B82F6",t.lineWidth=3,t.stroke())}),Math.random()}resetCounter(){const t=this.exerciseMode;this.perModeState&&this.perModeState[t]&&(this.perModeState[t].count=0,this.perModeState[t].state="up","mountainclimbers"===t&&(this.perModeState[t]._lastLeftKneeY=null,this.perModeState[t]._lastRightKneeY=null,this.perModeState[t]._climberState="neutral",this.perModeState[t]._lastClimberTime=0),"burpees"===t&&(this.perModeState[t]._burpeeState="ready")),this.postureStatus="unknown",this.accumulatedCorrectMs=0,this.timerRunning=!1,this.startCorrectTimestampMs=0}getStats(){const t=this.exerciseMode,e=this.perModeState&&this.perModeState[t]?this.perModeState[t]:{count:0,state:"up"};return{count:e.count||0,state:e.state||"up",posture:this.postureStatus,timeSec:Math.floor((this.accumulatedCorrectMs+(this.timerRunning?Date.now()-this.startCorrectTimestampMs:0))/1e3)}}getLastResults(){return this.lastResults}setCallbacks({onPushupCount:t,onPostureChange:e,onFormFeedback:i,onTimeUpdate:s}){this.onPushupCount=t,this.onPostureChange=e,this.onFormFeedback=i,this.onTimeUpdate=s}cleanup(){this.pose&&(this.pose.close(),this.pose=null),this.isInitialized=!1}}export{t as default};
//# sourceMappingURL=poseDetection-DoTgMxbD.js.map
